{"version":3,"sources":["Popable.tsx"],"names":["DEFAULT_LAYOUT","width","height","x","y","Popable","action","animated","animationType","backgroundColor","children","caret","caretPosition","content","numberOfLines","onAction","position","strictPosition","style","visible","wrapperStyle","ref","dimensions","popoverVisible","setPopoverVisible","popoverOffset","setPopoverOffset","left","top","popoverLayout","setPopoverLayout","popoverPagePosition","setPopoverPagePosition","childrenLayout","setChildrenLayout","computedPosition","setComputedPosition","isInteractive","isPopoverVisible","childrenRef","popoverRef","show","hide","handlers","Platform","OS","onHoverIn","onHoverOut","onPress","current","measure","_x","_y","_width","_height","pageX","pageY","onLongPress","handleHidePopover","handlePopoverLayout","measureInWindow","handleChildrenLayout","nextPosition","sharedPopoverProps","styles","container","transform","translateX","translateY","popoverTop","popoverBottom","alignItems","right","StyleSheet","create","zIndex","bottom"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  Platform,\n  // @ts-ignore\n  Pressable,\n  StyleSheet,\n  useWindowDimensions,\n  View,\n  ViewProps,\n} from 'react-native';\nimport Backdrop from './Backdrop';\nimport Popover, { PopoverProps } from './Popover';\nimport type { PopableManager } from './use-popable/types';\n\nexport type PopableProps = {\n  action?: 'press' | 'longpress' | 'hover';\n  animated?: PopoverProps['animated'];\n  animationType?: PopoverProps['animationType'];\n  backgroundColor?: PopoverProps['backgroundColor'];\n  caret?: PopoverProps['caret'];\n  caretPosition?: PopoverProps['caretPosition'];\n  children: any;\n  content: PopoverProps['children'];\n  numberOfLines?: PopoverProps['numberOfLines'];\n  onAction?: (visible: boolean) => void;\n  position?: PopoverProps['position'];\n  strictPosition?: boolean;\n  style?: PopoverProps['style'];\n  visible?: boolean;\n  wrapperStyle?: ViewProps['style'];\n};\n\nconst DEFAULT_LAYOUT = {\n  width: 0,\n  height: 0,\n  x: 0,\n  y: 0,\n};\n\nconst Popable = forwardRef<PopableManager, PopableProps>(function Popable(\n  {\n    action = 'press',\n    animated,\n    animationType,\n    backgroundColor,\n    children,\n    caret,\n    caretPosition,\n    content,\n    numberOfLines,\n    onAction,\n    position = 'top',\n    strictPosition = false,\n    style,\n    visible,\n    wrapperStyle,\n  },\n  ref\n) {\n  const dimensions = useWindowDimensions();\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  const [popoverOffset, setPopoverOffset] = useState({ left: 0, top: 0 });\n  const [popoverLayout, setPopoverLayout] = useState(DEFAULT_LAYOUT);\n  const [popoverPagePosition, setPopoverPagePosition] = useState({\n    left: 0,\n    top: 0,\n  });\n  const [childrenLayout, setChildrenLayout] = useState(DEFAULT_LAYOUT);\n  const [computedPosition, setComputedPosition] = useState(position);\n  const isInteractive = typeof visible === 'undefined';\n  const isPopoverVisible = isInteractive ? popoverVisible : visible;\n  const childrenRef = useRef<View>(null);\n  const popoverRef = useRef<View>(null);\n\n  useImperativeHandle(ref, () => ({\n    show: () => setPopoverVisible(true),\n    hide: () => setPopoverVisible(false),\n  }));\n\n  const handlers: { [prop: string]: () => void } = {};\n\n  if (isInteractive) {\n    if (action === 'hover' && Platform.OS === 'web') {\n      handlers.onHoverIn = () => {\n        setPopoverVisible(true);\n        onAction?.(true);\n      };\n\n      handlers.onHoverOut = () => {\n        setPopoverVisible(false);\n        onAction?.(false);\n      };\n    } else if (\n      action === 'press' ||\n      (action === 'hover' && Platform.OS !== 'web')\n    ) {\n      handlers.onPress = () => {\n        if (!visible) {\n          popoverRef.current?.measure(\n            (_x, _y, _width, _height, pageX, pageY) => {\n              setPopoverPagePosition({ left: pageX, top: pageY });\n            }\n          );\n        }\n\n        onAction?.(!visible);\n        setPopoverVisible(!visible);\n      };\n    } else {\n      handlers.onLongPress = () => {\n        onAction?.(!visible);\n        setPopoverVisible(!visible);\n      };\n    }\n  }\n\n  const handleHidePopover = useCallback(() => {\n    setPopoverVisible(false);\n    onAction?.(false);\n  }, [onAction]);\n\n  const handlePopoverLayout = useCallback(() => {\n    popoverRef.current?.measureInWindow((x, y, width, height) => {\n      setPopoverLayout({ x, y, width, height });\n    });\n  }, [popoverRef]);\n\n  const handleChildrenLayout = useCallback(() => {\n    childrenRef.current?.measureInWindow((x, y, width, height) => {\n      setChildrenLayout({ x, y, width, height });\n    });\n  }, [childrenRef]);\n\n  useEffect(() => {\n    let nextPosition = position;\n\n    if (!strictPosition) {\n      switch (position) {\n        case 'left':\n          if (popoverLayout.x <= 0) {\n            nextPosition = 'right';\n          }\n          break;\n\n        case 'right':\n          if (popoverLayout.x + popoverLayout.width > dimensions.width) {\n            nextPosition = 'left';\n          }\n          break;\n\n        case 'top':\n          if (popoverLayout.y <= 0) {\n            nextPosition = 'bottom';\n          }\n          break;\n\n        case 'bottom':\n          if (popoverLayout.y + popoverLayout.height >= dimensions.height) {\n            nextPosition = 'top';\n          }\n          break;\n      }\n    }\n\n    setComputedPosition(nextPosition);\n  }, [position, strictPosition, popoverLayout, childrenLayout, dimensions]);\n\n  useEffect(() => {\n    let left = 0;\n    let top = 0;\n\n    switch (computedPosition) {\n      case 'right':\n      case 'left':\n        top = (popoverLayout.height - childrenLayout.height) / 2;\n        break;\n\n      case 'top':\n      case 'bottom':\n        left = (popoverLayout.width - childrenLayout.width) / 2;\n        break;\n    }\n\n    setPopoverOffset({ left, top });\n  }, [computedPosition, popoverLayout, childrenLayout]);\n\n  const sharedPopoverProps = {\n    animated,\n    animationType,\n    backgroundColor,\n    caret,\n    caretPosition,\n    children: content,\n    numberOfLines,\n    position: computedPosition,\n  };\n\n  return (\n    <View style={[styles.container, wrapperStyle]}>\n      <Backdrop\n        visible={isInteractive && popoverVisible}\n        onPress={handleHidePopover}\n        popoverRef={popoverRef}\n        childrenRef={childrenRef}\n      >\n        {\n          // Backdrop renders the same popover because:\n          // since the backdrop adds a layer on top of the screen to\n          // detect any \"outside popover press\", the inner popover becomes\n          // unreachable: the upper layer would keep all the touch events.\n          // Because the backdrop uses a modal as a layer, we render that\n          // same popover inside the modal, and hide the initial one\n          // underneath (which explains why the popover below this one has\n          // `visible` set to `false`)\n          Platform.OS !== 'web' && (\n            <Popover\n              {...sharedPopoverProps}\n              forceInitialAnimation\n              visible={isPopoverVisible}\n              style={[\n                {\n                  position: 'absolute',\n                  transform: [\n                    { translateX: popoverPagePosition.left },\n                    { translateY: popoverPagePosition.top },\n                  ],\n                },\n                style,\n              ]}\n            />\n          )\n        }\n      </Backdrop>\n\n      <Popover\n        ref={popoverRef}\n        {...sharedPopoverProps}\n        onLayout={handlePopoverLayout}\n        visible={Platform.OS === 'web' ? isPopoverVisible : false}\n        style={[\n          computedPosition === 'top' && styles.popoverTop,\n          computedPosition === 'bottom' && styles.popoverBottom,\n          computedPosition === 'left' && {\n            alignItems: 'flex-end',\n            right: childrenLayout.width,\n          },\n          computedPosition === 'right' && { left: childrenLayout.width },\n          {\n            position: 'absolute',\n            transform: [\n              { translateX: popoverOffset.left * -1 },\n              { translateY: popoverOffset.top * -1 },\n            ],\n          },\n          style,\n        ]}\n      />\n\n      <Pressable\n        ref={childrenRef}\n        onLayout={handleChildrenLayout}\n        {...handlers}\n      >\n        {children}\n      </Pressable>\n    </View>\n  );\n});\n\nconst styles = StyleSheet.create({\n  container: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  popoverTop: {\n    bottom: '100%',\n  },\n  popoverBottom: {\n    top: '100%',\n  },\n});\n\nexport default Popable;\n"]}